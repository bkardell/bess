/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */

define("src/extendedjquery",[],function(){var e,t,r=jQuery;return r.easing.bounce=function(e,t,r,n,i){return 1/2.75>(t/=i)?n*7.5625*t*t+r:2/2.75>t?n*(7.5625*(t-=1.5/2.75)*t+.75)+r:2.5/2.75>t?n*(7.5625*(t-=2.25/2.75)*t+.9375)+r:n*(7.5625*(t-=2.625/2.75)*t+.984375)+r},r.expr[":"].matches=function(e,t,n){return r(e).is(n[3])},r.expr[":"].closest=function(e,t,n,i){var a=r(i).has(n[3]);return e===a[a.length-1]},r.expr[":"].notNth=function(e,t,n){return n[3]!=r(e).index()},r.expr[":"].notEq=r.expr[":"].notNth,r.expr[":"].siblings=function(e,t,n){var i=r(n[3]).get(0);return void 0!==i&&i!==e&&i.parentNode==e.parentNode},r.expr[":"]["nth-match"]=function(e,t,n){var i,a,o,s,c=0,u=0;for(a=n[3].split(","),i=e.parentNode,o=a[1].split("n"),base=parseInt(o[0],10),s=a[0],u=o.length>1&&""!==o[1]?parseInt(o[1],10):u,i.xcache||(i.xcache={}),i.xcache[s]||(i.xcache[s]=r(e).siblings().andSelf().filter(s)),c=0;i.xcache[s].length>c;c++)if(i.xcache[s].get(base*c+u-1)===e)return!0;return!1},e=function(e,t,n,i,a){r.each(e,function(e,i){r(i).animate(a,{queue:!1,duration:t,easing:n})})},r.fn.attract=function(t,r,n,i){e(this,t,r,i,{top:-i.position().top,left:-i.position().left})},r.fn.repel=function(t,r,n,i){e(this,t,r,i,{top:i.position().top,left:i.position().left})},r.fn.attractY=function(t,r,n,i){e(this,t,r,i,{top:i.position().top})},r.fn.repelY=function(t,r,n,i){e(this,t,r,i,{top:-i.position().top})},r.fn.attractX=function(t,r,n,i){e(this,t,r,i,{left:i.position().left})},r.fn.repelX=function(t,r,n,i){e(this,t,r,i,{left:-i.position().left})},t=function(e,t,n,i,a){r.each(e,function(e,i){r(i).animate(a,{queue:!1,duration:t,easing:n})})},r.fn.scaleXY=function(e,r,n,i){t(this,e,r,i,{height:i.height(),width:i.width()})},r.fn.scaleX=function(e,r,n,i){t(this,e,r,i,{width:i.width()})},r.fn.scaleY=function(e,r,n,i){t(this,e,r,i,{height:i.height()})},r.fn.slideLeft=function(e,t){r.each(this,function(n,i){i.origStyle=r(i).css("display"),i.style.display="block",r(i).animate({width:"hide"},{queue:!1,duration:e,easing:t})})},r.fn.slideRight=function(e,t){r.each(this,function(n,i){r(i).animate({width:"show"},{queue:!1,duration:e,easing:t})})},r}),function(e,t){"object"==typeof exports&&exports?module.exports=t:"function"==typeof define&&define.amd?define("lib/mustache",t):e.Mustache=t}(this,function(){function e(e,t){return RegExp.prototype.test.call(e,t)}function t(t){return!e(h,t)}function r(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function n(e){return(e+"").replace(/[&<>"'\/]/g,function(e){return b[e]})}function i(e){this.string=e,this.tail=e,this.pos=0}function a(e,t){this.view=e,this.parent=t,this._cache={}}function o(){this.clearCache()}function s(e,t,r,n){for(var i,a,o,c="",u=0,l=e.length;l>u;++u)switch(i=e[u],a=i[1],i[0]){case"#":if(o=r.lookup(a),"object"==typeof o)if(y(o))for(var d=0,p=o.length;p>d;++d)c+=s(i[4],t,r.push(o[d]),n);else o&&(c+=s(i[4],t,r.push(o),n));else if("function"==typeof o){var h=null==n?null:n.slice(i[3],i[5]);o=o.call(r.view,h,function(e){return t.render(e,r)}),null!=o&&(c+=o)}else o&&(c+=s(i[4],t,r,n));break;case"^":o=r.lookup(a),(!o||y(o)&&0===o.length)&&(c+=s(i[4],t,r,n));break;case">":o=t.getPartial(a),"function"==typeof o&&(c+=o(r));break;case"&":o=r.lookup(a),null!=o&&(c+=o);break;case"name":o=r.lookup(a),null!=o&&(c+=f.escape(o));break;case"text":c+=a}return c}function c(e){for(var t,r=[],n=r,i=[],a=0,o=e.length;o>a;++a)switch(t=e[a],t[0]){case"#":case"^":i.push(t),n.push(t),n=t[4]=[];break;case"/":var s=i.pop();s[5]=t[2],n=i.length>0?i[i.length-1][4]:r;break;default:n.push(t)}return r}function u(e){for(var t,r,n=[],i=0,a=e.length;a>i;++i)t=e[i],t&&("text"===t[0]&&r&&"text"===r[0]?(r[1]+=t[1],r[3]=t[3]):(r=t,n.push(t)));return n}function l(e){return[RegExp(r(e[0])+"\\s*"),RegExp("\\s*"+r(e[1]))]}var f={};f.name="mustache.js",f.version="0.7.2",f.tags=["{{","}}"],f.Scanner=i,f.Context=a,f.Writer=o;var d=/\s*/,p=/\s+/,h=/\S/,g=/\s*=/,v=/\s*\}/,m=/#|\^|\/|>|\{|&|=|!/,y=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};f.escape=n,i.prototype.eos=function(){return""===this.tail},i.prototype.scan=function(e){var t=this.tail.match(e);return t&&0===t.index?(this.tail=this.tail.substring(t[0].length),this.pos+=t[0].length,t[0]):""},i.prototype.scanUntil=function(e){var t,r=this.tail.search(e);switch(r){case-1:t=this.tail,this.pos+=this.tail.length,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,r),this.tail=this.tail.substring(r),this.pos+=r}return t},a.make=function(e){return e instanceof a?e:new a(e)},a.prototype.push=function(e){return new a(e,this)},a.prototype.lookup=function(e){var t=this._cache[e];if(!t){if("."==e)t=this.view;else for(var r=this;r;){if(e.indexOf(".")>0){t=r.view;for(var n=e.split("."),i=0;t&&n.length>i;)t=t[n[i++]]}else t=r.view[e];if(null!=t)break;r=r.parent}this._cache[e]=t}return"function"==typeof t&&(t=t.call(this.view)),t},o.prototype.clearCache=function(){this._cache={},this._partialCache={}},o.prototype.compile=function(e,t){var r=this._cache[e];if(!r){var n=f.parse(e,t);r=this._cache[e]=this.compileTokens(n,e)}return r},o.prototype.compilePartial=function(e,t,r){var n=this.compile(t,r);return this._partialCache[e]=n,n},o.prototype.getPartial=function(e){return e in this._partialCache||!this._loadPartial||this.compilePartial(e,this._loadPartial(e)),this._partialCache[e]},o.prototype.compileTokens=function(e,t){var r=this;return function(n,i){if(i)if("function"==typeof i)r._loadPartial=i;else for(var o in i)r.compilePartial(o,i[o]);return s(e,r,a.make(n),t)}},o.prototype.render=function(e,t,r){return this.compile(e)(t,r)},f.parse=function(e,n){function a(){if(S&&!j)for(;E.length;)delete A[E.pop()];else E=[];S=!1,j=!1}if(e=e||"",n=n||f.tags,"string"==typeof n&&(n=n.split(p)),2!==n.length)throw Error("Invalid tags: "+n.join(", "));for(var o,s,h,y,b,x=l(n),w=new i(e),k=[],A=[],E=[],S=!1,j=!1;!w.eos();){if(o=w.pos,h=w.scanUntil(x[0]))for(var I=0,T=h.length;T>I;++I)y=h.charAt(I),t(y)?E.push(A.length):j=!0,A.push(["text",y,o,o+1]),o+=1,"\n"==y&&a();if(!w.scan(x[0]))break;if(S=!0,s=w.scan(m)||"name",w.scan(d),"="===s?(h=w.scanUntil(g),w.scan(g),w.scanUntil(x[1])):"{"===s?(h=w.scanUntil(RegExp("\\s*"+r("}"+n[1]))),w.scan(v),w.scanUntil(x[1]),s="&"):h=w.scanUntil(x[1]),!w.scan(x[1]))throw Error("Unclosed tag at "+w.pos);if(b=[s,h,o,w.pos],A.push(b),"#"===s||"^"===s)k.push(b);else if("/"===s){if(0===k.length)throw Error('Unopened section "'+h+'" at '+o);var _=k.pop();if(_[1]!==h)throw Error('Unclosed section "'+_[1]+'" at '+o)}else if("name"===s||"{"===s||"&"===s)j=!0;else if("="===s){if(n=h.split(p),2!==n.length)throw Error("Invalid tags at "+o+": "+n.join(", "));x=l(n)}}var _=k.pop();if(_)throw Error('Unclosed section "'+_[1]+'" at '+w.pos);return A=u(A),c(A)};var x=new o;return f.clearCache=function(){return x.clearCache()},f.compile=function(e,t){return x.compile(e,t)},f.compilePartial=function(e,t,r){return x.compilePartial(e,t,r)},f.compileTokens=function(e,t){return x.compileTokens(e,t)},f.render=function(e,t,r){return x.render(e,t,r)},f.to_html=function(e,t,r,n){var i=f.render(e,t,r);return"function"!=typeof n?i:(n(i),void 0)},f}()),define("src/logging",[],function(){var e=window.console,t=function(){};return e||(e={trace:t,debug:t,info:t,warn:t,error:t,fatal:t}),e.debug||(e.debug=e.log),e}),define("src/modules",["src/extendedjquery","lib/mustache","src/logging"],function(e,t,r){var n=function(e){return{resolver:"string",arg:e||""}},i=function(e){return{resolver:"find",arg:[n(e||":self")]}},a=function(e){return{resolver:"obj",arg:e||"{}"}},o={effect:{properties:["name","target","duration","easing","relative"],defaults:{target:i(),duration:n("slow"),easing:n("swing"),relative:i()},apply:function(t,r){var n,i=t.target.length,a=t.name.split(","),o=function(e,t,r,n){return function(){e&&0===--e&&r.target.trigger("post-"+n)}};0===i&&r.dequeue("pseudo"),r.queue("pseudo").unshift(e.noop);for(var s=0;a.length>s;s++)n=e.trim(a[s]),t.target[n](t.duration,t.easing,o(i,r,t,n),t.relative)}},"class":{properties:["op","name","target"],defaults:{op:"toggle",target:i()},apply:function(t){t.name=e.isArray(t.name)?t.name.join(" "):t.name,t.name&&t.target[t.op+"Class"](t.name)}},redirect:{properties:["uri"],defaults:{},apply:function(e){window.location.href=e.uri}},form:{properties:["target","data"],defaults:{},apply:function(t){var r,n,i,a=t.target[0];if(t.data=t.data||"",t.target)for(t.target="form"===a.tagName.toLowerCase()?t.target.find(":file,:hidden,:input,:radio,:checkbox"):t.target,n="string"==typeof t.data||e.isArray(t.data),r=0;t.target.length>r;r++)i=n?t.data:t.data[t.target[r].name],e(t.target[r]).val(i)}},html:{properties:["op","source","target"],defaults:{target:i(),source:{resolver:"html",arg:i()},op:{resolver:"string",arg:"replaceContent"}},apply:function(r,n){var i,a,o,c;i=["append","replaceContent","prepend","replaceWith","wrapInner","wrap"],a=r.id||r.source,o=e.inArray(r.op,i)>-1?a:null,a?(n.queue("pseudo").unshift(e.noop),c=t.to_html(o,r.data,{}),s(r.op,c,r.target),n.dequeue("pseudo")):s(r.op,o,r.target)}}},s=function(e,t,n,i){r.debug("Default Modifier called within Modules."),i&&i()},c=function(e){return o[e]};return c.resolvers={str:n,find:i,obj:a},c.setModifier=function(e){s=e},c.cache=o,c}),define("src/dommod",["src/extendedjquery","src/logging"],function(e,t){var r=function(r){var n,i,a;for(a=r.find("*").filter(Bess.engine.domInsertRules.join(",")),n=0;a.length>n;n++)i=new e.Event("html-inserted"),i.preventDefault(),t.debug("Triggering html-inserted."),e(a[n]).trigger(i);t.debug("Triggering html-modified."),r.trigger("html-modified")};return mod=function(n,a,o){var s,c,u,l;if("replaceContent"==n||"remove"===n||"empty"===n){for(s=e("*",o),u=s.filter('[bess_parsed="true"]'),i=0;u.length>i;i++)for(c=u[i],l=bessRules.length-1;l>=0;l--)bessRules[l].selector.boundFrom===c&&bessRules.splice(l,1);if("replaceContent"===n)o.empty(),n="append";else if("remove"===n||"empty"===n)return o[n](),t.debug("Triggering html-modified..."),o.trigger("html-modified"),void 0}e.browser.msie?(id=e.now(),d=document.createElement("div"),d.id="temp"+id,d.style.display="none",document.body.appendChild(d),d=document.getElementById("temp"+id),d.innerHTML=a,o[n](e(d.childNodes)),document.body.removeChild(d)):o[n](a),Bess.engine.init(o,!0),r(o)}}),define("src/jpath",["src/extendedjquery"],function(e){var t=function(r,n,i,a){var o,s,c=0,u=!0;if(r&&a>i.length)if(e.isArray(r))for(;r.length>c;c++)t(r[c],n,i,a);else{for(c=0;u&&n.length>c;c++)s=r[n[c].prop],s!==void 0?n[c].re&&(u=n[c].re.test(s)):u=!1;u&&i.push(r);for(o in r)"object"==typeof r[o]&&t(r[o],n,i,a)}},r=function(r,n,i){for(var a,o,s,c=0,u=n.split(/(\[|\])/),l=[],f=[];u.length>c;c++)o=e.trim(u[c]),/\[|\]/.test(o)||""===o||(o=u[c].split(/\W?=/),a=n.match(/(\W?=)/),s={prop:e.trim(o[0])},o.length>1&&a&&a.length>0&&(a=a[0].charAt(0),o[1]=o[1].replace(/\'/g,""),"^"===a?o[1]="^"+o[1]:"$"===a?o[1]=o[1]+"$":"*"!==a&&(o[1]="^"+o[1]+"$"),s.re=RegExp(o[1])),l.push(s));return t(r,l,f,i||Number.MAX_VALUE),f};return r}),define("src/typeresolvers",["src/extendedjquery","lib/mustache","src/jpath"],function(e,t,r){var n=function(t,r){var n,i,a,o,s,c;return n=(r[0]+" ").split("<"),a=""===n[0],i=a?"#"+t.attr("id")+n[1]:n[0],n.length>1&&!a?(o="*"==n[0],s=o?"*:not(#"+t.attr("id")+")":n[0],t=t.closest(s)," "!=n[1]&&(t=t.find(n[1])),c=t):c=e(i),c},i=function(e,t){var r,n,i,a,o=0,s=[],c=e.length%t;for(a=Math.floor(e.length/t),n=0;t>n;n++){for(i=[],a=0===s.length?a+c:Math.round(e.length/t),r=0;a>r;r++)e[o]&&(i.push(e[o]),o++);s.push(i)}return s},a={message:function(t,r,n,i,a){var o=a||{};r=e.isArray(r)?r[0]:r,n.setVal(i,r&&""!==r?o[r]:o)},capture:function(t,r,i,a){var o,s=[];for(t=n(t,r),o=0;t.length>o;o++)s.push(e(t[o]).val());i.setVal(a,s)},collect:function(t,r,n,i){var a,o=r[0],s=t,c=[],u="";2===r.length?"string"==typeof r[1]?u=r[1]:s=r[1]:3===r.length&&"string"==typeof r[2]&&(s=r[1],u=r[2]),s.jquery&&(s=e.makeArray(s)),s=e.isArray(s)?s:[s];for(var l=0;s.length>l;l++)a=e(s[l]),a.attr(o)?c.push(a.attr(o)):u&&c.push(u);n.setVal(i,c)},cut:function(t,r,n,i){var a=e("<div></div>");a.append(r[0][0]),n.setVal(i,a.html())},markup:function(t,r,n,i){n.setVal(i,e(r[0][0]).html())},number:function(e,t,r,n){r.setVal(n,parseInt(t[0],10))},string:function(e,t,r,n){r.setVal(n,""+t[0])},find:function(e,t,r,i){r.setVal(i,n(e,t))},request:function(t,r,n,i){var a=r[0],o={success:function(e){n.setVal(i,e)},error:function(){var e=i+" ("+this.url+"):"+arguments[2];n.setError(e,arguments[0])},type:"GET",dataType:"text"};"string"==typeof a?o.url=a:"string"==typeof a[0]?o.url=a[0]:a[0].tagName&&"form"===a[0].tagName.toLowerCase()?(o.url=a[0].getAttribute("action"),o.data=a.serialize(),o.type=a[0].getAttribute("method")||"GET",o.contentType=a[0].getAttribute("enctype")||"application/x-www-form-urlencoded",a[0].getAttribute("accept")&&(o.accepts=a[0].getAttribute("accept"))):o.data=e.param(a),r.length>=2&&(o.type=r[1]),3===r.length&&(o.url=r[2]),0===o.url.indexOf("#")?n.setVal(i,t):""===o.url?n.setVal(i,""):e.ajax(o)},obj:function(t,r,n,i){var a,o={};"{"===r[0].match(/\S/)[0]?n.setVal(i,JSON.parse(r[0])):(a=r[0].split("&"),e.each(a,function(t,r){var n,i=r.split("=");o[i[0]]?(n=o[i[0]],e.isArray(o[i[0]])||(o[i[0]]=[o[i[0]]]),o[i[0]].push(i[1])):o[i[0]]=i[1]}),n.setVal(i,o))},cookie:function(e,t,r,n){a.obj(e,document.cookie,r,n,",")},combine:function(t,r,n,i){for(var a={},o=0,s=r.length;s>o;o++)e.extend(a,r[o]);n.setVal(i,a)},mash:function(t,r,n,a){var o,s,c,u,l,f=r[1],d=0;if(o=e.isArray(r[0])?r[0][0]:r[0],"string"==typeof r[1])try{f=JSON.parse(f)}catch(p){f=[f]}if(l=function(e,t,r,i){e.apply(t,function(o,s){d++,o?(u=!0,n.setError(e,o)):(i[r]=s,d>=t.length&&n.setVal(a,i.join("")))})},e.isArray(f)&&r.length>2)for(f=i(f,r[2]),s=Array(f.length),c=0;f.length>c&&!u;c++)l(o,f[c],c,s);else o.apply(f,function(e,t){e?n.setError(o,e):n.setVal(a,t)})},template:function(t,r,n,i){var a=n,o=window.bess_templates?window.bess_templates:{},s=o[r[0]];s?a.setVal(i,s):e.get(r[0],function(e){a.setVal(i,e)},"html").error(function(){a.setError(i,"unable to load "+r[0])})},subset:function(t,n,i,a){var o="string"==typeof n[1]?JSON.parse(n[1]):n[1];path=e.isArray(n[0])?n[0][0]:n[0],o=r(o,path,n[2]),i.setVal(a,o)},fromQuery:function(e,t,r,n){var i="",a=0,o=window.location.search.substring(1).split("&");for(a=0;o.length>a;a++)0===o[a].indexOf(t[0])&&(i=o[a].split("=")[1]);r.setVal(n,i)},range:function(e,t,r,n){var i=0,a=t[0]||"0",o=t[1]||"0",s=t[2]||"1",c=[];for(i=parseInt(a,10);parseInt(o,10)>i;i+=parseInt(s,10))c.push(i);r.setVal(n,c)}};return a.to=a.find,a.from=a.find,a.where=a.find,a}),define("src/typeresolverengine",["src/extendedjquery","src/typeresolvers","src/logging"],function(e,t,r){var n=t,i=function(e,t,r,n,i){setTimeout(function(){a.property(e,t,r,n,i)},1)},a={properties:function(e,t,n,a,o){var s,c={},u={ct:0,setVal:function(e,i){c[e]=i,this.ct--,r.debug("resolved "+e+"..."+this.ct+" remaining"),0===this.ct&&n(c,t)},setError:function(){o(c,arguments)}};for(s in e)e[s].resolver&&("none"===e[s].arg?delete e[s]:u.ct++);try{for(s in e)e[s].resolver&&i(e[s],t,u,s,a)}catch(l){u.setError(c,l)}},property:function(t,i,o,c,u){var l=o,f=[t],d=t.arg;e.isArray(d)||a.buildStack(t,f);var p=function(e,t){return"string"==typeof e&&s(i,e.replace(/th\(index\)/g,"th("+i.index()+")"))||t},h=function(e,t,r){return function(n,i){e--,t[this.i]=p(i,i),0===e&&r(t)}},g=function(e,t){for(var r,n=e.length,o=[],s=0;e.length>0;)r=e.shift(),a.property(r,i,{i:s++,setVal:h(n,o,t),setError:l.setError},c,u)},v=function(t){if(t&&t.pop){var a=t.pop();if(e.isArray(a.arg))g(a.arg.slice(0),function(e){if(n[a.resolver])try{n[a.resolver](i,e,l,c,u)}catch(t){l.setError(a.resolver,t)}else r.error("unknown type resolver: '"+a.resolver+"'")});else if(d=p(a.arg,d),l=0===t.length?o:{setVal:function(e,t){d=p(t,t),v()},setError:l.setError},n[a.resolver])try{n[a.resolver](i,[d],l,c,u)}catch(s){l.setError(a.resolver,s)}else r.error("unknown type resolver: '"+a.resolver+"' should it be in an array?")}};v(f)},buildStack:function(e,t){e.arg.resolver&&(t.push(e.arg),a.buildStack(e.arg,t))}},o=e.now(),s=function(e,t){return e.attr("id")||e.attr("id","bess_"+o++),t.replace(":self","#"+e.attr("id"))};return a}),define("src/stringscanner",[],function(){var e={create:function(e){var t=e;return{toString:function(){return t},current:"BEGIN",test:null,index:0,tailIndex:t.length-1,setIndex:function(e){return this.current=t[e],this.index=e,this},readUntil:function(e){var r,n=0,i=e.length?e:[e];for(this.index;this.tailIndex>=this.index;this.index++)for(r=t.charAt(this.index),n=0;i.length>n;n++)if(i[n]&&i[n].test(r))return this.current=r,this.test=i[n],this;return this},sniff:function(e){var r=t.substr(this.index,e.length);return r===e?(this.index+=e.length,this.current=t.charAt(this.index),!0):!1},capture:function(e,r){return t.substring(e,r)},nextIndexOf:function(e){return t.indexOf(e,this.index)},tailIndexOf:function(e){return t.lastIndexOf(e,this.tailIndex)},peek:function(e){return t.charAt(this.index+(e||1))},isDone:function(e){return this.index>=(e||this.tailIndex)},advance:function(e){return this.index=this.index+(e||1),this.current=t.charAt(this.index),this},skipWhitespace:function(){return this.readUntil([/\S/]),this}}}};return e}()),define("src/bessvalueparser",["src/extendedjquery","src/stringscanner","src/modules","src/typeresolvers","src/logging"],function(e,t,r,n,i){return function(e){var a={isQuote:/\'/,isNumeric:/\d/,isSemi:/\;/,isOpenParen:/\(/,isCloseParen:/\)/,isOpenBrace:/\{/,isComma:/\,/,isColon:/\:/,isAtSymbol:/\@/,whiteSpace:/\s/,behavior:/^\-be\-([^\-]*)|^([a-z]*[A-z]*)/,pseudo:/\:/,pre:/\([^\)]+\)/,ids:/#[\d\w\-_]+/g,cls:/[\.:\[][^\.:\[+>]+/g,tag:/(^|[\s\+>])\w+/g};a.chop=[a.ids,a.cls,a.tag],"map"in Array.prototype||(Array.prototype.map=function(e,t){for(var r=Array(this.length),n=0,i=this.length;i>n;n++)n in this&&(r[n]=e.call(t,this[n],n,this));return r});var o={calc:function(e){return e=e.replace(a.pre,""),parseInt(a.chop.map(function(t){var r=e.match(t);return r?r.length.toString(16):0}).join(""),16)}},s=function(r,n){var i=[],a=e.Deferred();return e.when(l(t.create(r),n)).then(function(){i=d(t.create(r),n),n&&e(n).attr("bess_parsed","true"),a.resolve(i)}),a.promise()},c=function(e){i.debug("resolved "+e.type+'"'+e.name+'" at '+(new Date).getTime()),"module"===e.type?r.cache[e.name]=e:"type"===e.type&&(n[e.typeName]=e)},u=function(t,r){var n,a=e.Deferred();return require([r],function(e){if(e)if("package"===t)for(n=0;e.length>n;n++)c(e[n]);else e.type=t,c(e);else i.error("Unable to find "+t+" at "+r);a.resolve()}),a.promise()},l=function(t){var r,n=e.Deferred(),i=[];if(t.skipWhitespace(),t.isDone()&&n.resolve(),f(t),"@"!==t.current)n.resolve();else{for(;"@"===t.current;)t.advance(),t.sniff("import")&&(t.skipWhitespace(),r=E(t),i.push(u(r,k(t))),t.advance().readUntil(a.isAtSymbol));e.when.apply(e,i).then(function(){n.resolve()})}return n.promise()},f=function(e){return"/"===e.current&&"*"===e.peek()?(e.setIndex(e.nextIndexOf("*/")).advance(2),e.skipWhitespace(),!0):void 0},d=function(e,t){var r,n=[];if(e=p(e),e.skipWhitespace(),e.isDone())return n;for(f(e),r=h(g(e),t);r;)r?n=n.concat(r):i.debug("No rule returned during parseRules loop."),r=h(g(e),t);return n},p=function(e){return e.skipWhitespace(),e.sniff("@")?(e.readUntil(a.isSemi).advance(),p(e)):e},h=function(t,n){if(t){var i,s,c={},u=[];return e.each(t.declarations,function(e){var t=e.match(a.behavior);if(t){var r=t[2]?t[2]:t[1];r&&(c[r]=!0)}}),e.each(t.selectors,function(l){var f=t.selectors[l];e.isEmptyObject(c)||(i=f.split(a.pseudo),s={pseudo:i.pop(),select:i.join(":"),boundFrom:n,ruleId:t.pid},s.score=o.calc(s.select),e.each(c,function(e){var n=r(e);parsedRule=y(t.declarations,e,n.properties),u.push({selector:s,declaration:parsedRule,module:e})}))}),u}},g=function(e,t){var r,n=t||{selectors:[],pid:e.index};return e.skipWhitespace(),f(e),r=e.skipWhitespace().index,e.readUntil([a.isComma,a.isOpenBrace]),","===e.current?(v(n,e.capture(r,e.index)),e.advance(),g(e,n)):"{"===e.current?(v(n,e.capture(r,e.index)),e.advance(),n.declarations=m(e,{}),n):void 0},v=function(t,r){r.match(/\)/g)&&!r.match(/\(/g)?t.selectors[t.selectors.length-1]+=", "+r:t.selectors.push(e.trim(r))},m=function(e,t){var r,n=e.skipWhitespace().index;return f(e)?m(e,t):("}"!==e.current?(e.readUntil(a.isColon),r=e.capture(n,e.index),n=e.advance().skipWhitespace().index,e.readUntil(a.isSemi),t[r]=e.capture(n,e.index),e.advance(),m(e,t)):e.advance(),t)},y=function(r,n,i){var a={},o=r,s=r[n];s&&(o=e.extend({},b(s,n,i),r));var c=function(r){var i=n+"-"+r,s=o[i];s&&(a[r]=e.isPlainObject(s)?s:x(t.create(s))[0])};return e.each(i,function(e,t){c(t)}),a},b=function(e,r,n){for(var i=x(t.create(e),!0),a=0,o=0,s={},c=0;i.length>c;c++)n.length>c&&(s[r+"-"+n[o]]={}),i[c].x&&(o=0,a++),s[r+"-"+n[o]][a+""]=i[c],o++;return s},x=function(e,t){var r,n=[],i=0,a={};for(i;;i++){if(r=w(e),!r)return n;a[i]=r,n.push(t?r:a)}},w=function(e){var t;if(!e.skipWhitespace().isDone()){if("'"===e.current)return{resolver:"string",arg:k(e)};if(a.isNumeric.test(e.current))return{resolver:"number",arg:A(e)};if(a.isComma.test(e.current))return t=w(e.advance()),t.x=!0,t;var r={resolver:E(e),arg:[]};if(a.isCloseParen.test(e.current))return e.advance(),r;for(t=w(e,!0);t&&(r.arg.push(t),e.skipWhitespace().advance(),a.isComma.test(e.peek(-1)));)t=w(e,!0);return r}},k=function(e){var t=e.capture(e.advance().index,e.readUntil(a.isQuote).index);return e.advance(),t},A=function(e){var t=e.capture(e.index,e.readUntil([a.whiteSpace,a.isSemi]).index);return e.advance(),t},E=function(e){var t=e.capture(e.index,e.readUntil([a.isOpenParen]).index);return e.advance(),t},S={},j=function(t,r,n){var a,o,c=[],u=0;window.localStorage||(window.localStorage={});var l=function(t,r){var n=e.Deferred();return u--,r&&e(r).attr("bess_parsed")?n.resolve():s(t,r).done(function(e){c=c.concat(e),n.resolve()}),n.promise()},f=function(e,t){l(e,t).done(d)},d=function(){0===u&&t&&t(c)};return S=n||{},r?(u+=r.length,e.each(r,function(t,r){e.get(r,f,"text")})):(a=e('link[type="text/bess"]'),u+=a.length,o=e('style[type="text/bess"]'),u+=o.length,i.debug("BESS found "+u+" sheets to parse."),a.each(function(){var t=this;i.debug("BESS parsing link tag."),this.disabled||/^\w+:/.test(e(this).attr("href"))||!mediumApplies(this.media)||e(this).attr("bess_loaded")?e(this).attr("bess_loaded")&&(i.debug("Link tag found bess_loaded already."),f("",t)):(e(this).attr("bess_loaded","true"),e.get(this.href,function(e){f(e,t)},"text"))}),o.each(function(){i.debug("BESS parsing style tag."),f(this.innerHTML,this)})),this};mediumApplies=window.media&&window.media.query||function(t){if(!t)return!0;if(t in S)return S[t];var r=e('<style media="'+t+'">body {position: relative; z-index: 1;}</style>').appendTo("head");return S[t]=[1==e("body").css("z-index"),r.remove()][0]};var I=function(e,t){var r=[];return s(e,t).done(function(e){r=e}),r};return{parse:I,loadAndParse:j}}(e)}),define("src/behavior",["src/extendedjquery","src/modules","src/dommod","src/typeresolvers","src/typeresolverengine","src/bessvalueparser","src/logging"],function(e,t,r,n,i,a,o){t.setModifier(r);var s=[],c=function(t,r){a.loadAndParse(function(n){e.each(n,function(e){s.push(e.selector.select)}),window.bessRules=window.bessRules.concat(n),b(t,window.bessRules,!r)})},u=n,l=function(e){return e.sort(function(e,t){return e.selector.score>t.selector.score?1:t.selector.score>e.selector.score?-1:0})},f=function(e,t,r){r.queue("pseudo",[function(){r.trigger("pre-"+e).dequeue("pseudo")},function(){t(),r.dequeue("pseudo")},function(){r.trigger("post-"+e).dequeue("pseudo")}]),r.dequeue("pseudo")};window.localStorage||(window.localStorage={});var d={clicked:"click",changed:"change",blurred:"focusout",validated:"submit"},p=function(t){var r=d[t]?d[t]:t;return"transitioned"==t&&(r=e.browser.webkit?"webkitTransitionEnd":e.browser.opera?"oTransitionEnd":e.browser.mozilla?"transitionend":"transitionend"),r},h=function(t,r){t.preventDefault(),t.actionable||(t.actionable=[],t.actionableIds=[],t.target=t.currentTarget||t.target),-1===e.inArray(t.data.module+":"+t.data.selector.ruleId,t.actionableIds)&&(t.message=r,t.actionable.push(t.data),t.actionableIds.push(t.data.module+":"+t.data.selector.ruleId))},g={},v=function(e){var t={},r=null,n=null;for(r in e){var i=e[r];for(n in i)t[n]=!0}return t},m=function(e){var t,r=[],n=v(e),i=null;for(i in n){t={};for(var a in e){if(!e[a][i])return r;t[a]=e[a][i]}r.push(t)}return r},y=function(r){var n=r.selector.pseudo,a=r.selector,s=p(n);e(r.selector.select).live(s,r,h),g[s]||(e(document).bind(s,function(r){var s,c={},u={};if(r.actionable){if("html-inserted"===r.type){if(r.target.bess_dom_inserted)return!1;r.target.bess_dom_inserted=!0}if("html-modified"===r.type&&r.currentTarget!==r.target)return o.debug("bailing... html-modified current target:"+r.currentTarget.tagName+" - target:"+r.target.tagName),void 0;-1!==r.type.indexOf("post-")?r.currentTarget=r.target:"html-inserted"===r.type&&r.currentTarget!==r.target?(o.debug("switching... html-inserted current target:"+r.currentTarget+" - target:"+r.target),r.currentTarget=r.target):"submit"===r.type&&r.target.tagName&&"BUTTON"===r.target.tagName&&(r.target=r.currentTarget);for(var l=0;r.actionable.length>l;l++)s=r.actionable[l],o.debug("handling "+s.selector.select+" "+a.pseudo),c[s.module]=c[s.module]||{},s.selector.pseudo==n&&(e(r.target).is(s.selector.select)||e(r.currentTarget).is(s.selector.select))&&e.extend(c[s.module],s.declaration),u[s.selector.select]=!0;o.debug("merged:"+JSON.stringify(c,null,4));var d=e(r.currentTarget);f(n,function(){for(var n in c){var s=new t(n);if(s){o.debug("resolving module..."+n);var u=m(c[n]);for(l=0;u.length>l;l++){var f=e.extend({},s.defaults,u[l]);i.properties(f,d,s.apply,r.message,function(e,t){o.error("Problem resolving: "+t[0]+"\n\n- "+t[1].message+"\n\n- in "+JSON.stringify(f)),e.topic?d.trigger("error"):e.target&&e.target.trigger("error")})}}else o.error('Ignoring unknown module "'+n+'" in "'+a.select+":"+a.pseudo+'"')}},d)}}),g[s]=!0)},b=function(t,r,n){if(t||(t=e(document)),l(r),e.each(r,function(e,r){y(r,t),n&&/html-inserted$/.test(r.selector.pseudo)&&s.push(r.selector.select)}),n){o.debug("triggering html-inserted globally...");var i=function(){setTimeout(function(){e(s.join(",")).trigger("html-inserted")},1)};e.isReady?i():e.ready(i)}};return{domInsertRules:s,"::":u,":":t.cache,process:b,init:c}}),define("src/bess.js",["src/extendedjquery","src/behavior","src/bessvalueparser","src/modules","src/logging"],function(e,t,r,n,i){var a=function(){r.loadAndParse(function(e){i.debug("BESS go parse found "+e.length+" rules."),window.bessRules=bessRules.concat(e),t.init()})};return r.loadAndParse(function(t){i.debug("BESS early parse found "+t.length+" rules."),window.bessRules=t,e.isReady?a():e(document).ready(a)}),Bess={parser:r,engine:t,resolvers:n.resolvers}});