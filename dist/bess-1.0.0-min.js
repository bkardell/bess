/**
 * TIBCO PageBus(TM) version 2.0.0
 *
 * Copyright (c) 2006-2009, TIBCO Software Inc.
 * All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not
 * use this file except in compliance with the License. You may obtain a copy
 * of the License at http://www.apache.org/licenses/LICENSE-2.0 . Unless
 * required by applicable law or agreed to in writing, software distributed
 * under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
 * CONDITIONS OF ANY KIND, either express or implied. See the License for the
 * specific language governing permissions and limitations under the License.
 *
 *
 * Includes code from the official reference implementation of the OpenAjax
 * Hub that is provided by OpenAjax Alliance. Specification is available at:
 *
 *  http://www.openajax.org/member/wiki/OpenAjax_Hub_Specification
 *
 * Copyright 2006-2009 OpenAjax Alliance
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not
 * use this file except in compliance with the License. You may obtain a copy
 * of the License at http://www.apache.org/licenses/LICENSE-2.0 . Unless
 * required by applicable law or agreed to in writing, software distributed
 * under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR
 * CONDITIONS OF ANY KIND, either express or implied. See the License for the
 * specific language governing permissions and limitations under the License.
 *
 ******************************************************************************/

/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */

define("src/extendedjquery",[],function(){var e,t,r=jQuery;return r.easing.bounce=function(e,t,r,n,i){return 1/2.75>(t/=i)?n*7.5625*t*t+r:2/2.75>t?n*(7.5625*(t-=1.5/2.75)*t+.75)+r:2.5/2.75>t?n*(7.5625*(t-=2.25/2.75)*t+.9375)+r:n*(7.5625*(t-=2.625/2.75)*t+.984375)+r},r.expr[":"].matches=function(e,t,n){return r(e).is(n[3])},r.expr[":"].closest=function(e,t,n,i){var s=r(i).has(n[3]);return e===s[s.length-1]},r.expr[":"].notNth=function(e,t,n){return n[3]!=r(e).index()},r.expr[":"].notEq=r.expr[":"].notNth,r.expr[":"].siblings=function(e,t,n){var i=r(n[3]).get(0);return void 0!==i&&i!==e&&i.parentNode==e.parentNode},r.expr[":"]["nth-match"]=function(e,t,n){var i,s,a,o,c=0,u=0;for(s=n[3].split(","),i=e.parentNode,a=s[1].split("n"),base=parseInt(a[0],10),o=s[0],u=a.length>1&&""!==a[1]?parseInt(a[1],10):u,i.xcache||(i.xcache={}),i.xcache[o]||(i.xcache[o]=r(e).siblings().andSelf().filter(o)),c=0;i.xcache[o].length>c;c++)if(i.xcache[o].get(base*c+u-1)===e)return!0;return!1},e=function(e,t,n,i,s){r.each(e,function(e,i){r(i).animate(s,{queue:!1,duration:t,easing:n})})},r.fn.attract=function(t,r,n,i){e(this,t,r,i,{top:-i.position().top,left:-i.position().left})},r.fn.repel=function(t,r,n,i){e(this,t,r,i,{top:i.position().top,left:i.position().left})},r.fn.attractY=function(t,r,n,i){e(this,t,r,i,{top:i.position().top})},r.fn.repelY=function(t,r,n,i){e(this,t,r,i,{top:-i.position().top})},r.fn.attractX=function(t,r,n,i){e(this,t,r,i,{left:i.position().left})},r.fn.repelX=function(t,r,n,i){e(this,t,r,i,{left:-i.position().left})},t=function(e,t,n,i,s){r.each(e,function(e,i){r(i).animate(s,{queue:!1,duration:t,easing:n})})},r.fn.scaleXY=function(e,r,n,i){t(this,e,r,i,{height:i.height(),width:i.width()})},r.fn.scaleX=function(e,r,n,i){t(this,e,r,i,{width:i.width()})},r.fn.scaleY=function(e,r,n,i){t(this,e,r,i,{height:i.height()})},r.fn.slideLeft=function(e,t){r.each(this,function(n,i){i.origStyle=r(i).css("display"),i.style.display="block",r(i).animate({width:"hide"},{queue:!1,duration:e,easing:t})})},r.fn.slideRight=function(e,t){r.each(this,function(n,i){r(i).animate({width:"show"},{queue:!1,duration:e,easing:t})})},r}),define("lib/pagebus",[],function(){window.OpenAjax||(OpenAjax=new function(){var e="org.openajax.hub.",t={};this.hub=t,t.implementer="http://openajax.org",t.implVersion="2.0",t.specVersion="2.0",t.implExtraData={};var r={};t.libraries=r,t.registerLibrary=function(t,n,i,s){r[t]={prefix:t,namespaceURI:n,version:i,extraData:s},this.publish(e+"registerLibrary",r[t])},t.unregisterLibrary=function(t){this.publish(e+"unregisterLibrary",r[t]),delete r[t]},t._subscriptions={c:{},s:[]},t._cleanup=[],t._subIndex=0,t._pubDepth=0,t.subscribe=function(e,t,r,n,i){r||(r=window);var s=e+"."+this._subIndex,a={scope:r,cb:t,fcb:i,data:n,sid:this._subIndex++,hdl:s},o=e.split(".");return this._subscribe(this._subscriptions,o,0,a),s},t.publish=function(e,t){var r=e.split(".");if(this._pubDepth++,this._publish(this._subscriptions,r,0,e,t),this._pubDepth--,this._cleanup.length>0&&0==this._pubDepth){for(var n=0;this._cleanup.length>n;n++)this.unsubscribe(this._cleanup[n].hdl);delete this._cleanup,this._cleanup=[]}},t.unsubscribe=function(e){var t=e.split("."),r=t.pop();this._unsubscribe(this._subscriptions,t,0,r)},t._subscribe=function(e,t,r,n){var i=t[r];r==t.length?e.s.push(n):(e.c===void 0&&(e.c={}),e.c[i]===void 0?(e.c[i]={c:{},s:[]},this._subscribe(e.c[i],t,r+1,n)):this._subscribe(e.c[i],t,r+1,n))},t._publish=function(e,t,r,n,i,s){if(e!==void 0){var a;if(r==t.length?a=e:(this._publish(e.c[t[r]],t,r+1,n,i,s),this._publish(e.c["*"],t,r+1,n,i,s),a=e.c["**"]),a!==void 0)for(var o=a.s,c=o.length,u=0;c>u;u++)if(o[u].cb){var l=o[u].scope,f=o[u].cb,p=o[u].fcb,h=o[u].data;"string"==typeof f&&(f=l[f]),"string"==typeof p&&(p=l[p]),(!p||p.call(l,n,i,h))&&f.call(l,n,i,h,s)}}},t._unsubscribe=function(e,t,r,n){if(e!==void 0){if(t.length>r){var i=e.c[t[r]];if(this._unsubscribe(i,t,r+1,n),0==i.s.length){for(var s in i.c)return;delete e.c[t[r]]}return}for(var a=e.s,o=a.length,c=0;o>c;c++)if(n==a[c].sid)return this._pubDepth>0?(a[c].cb=null,this._cleanup.push(a[c])):a.splice(c,1),void 0}}},OpenAjax.hub.registerLibrary("OpenAjax","http://openajax.org/hub","1.0",{})),window.PageBus||(PageBus=new function(){var e=0,t=[],r=this;this.version="2.0.0",this._debug=function(){window["debugger"]},_badParm=function(){throw Error("OpenAjax.hub.Errors.BadParameters")},_valPub=function(e){(null==e||-1!=e.indexOf("*")||-1!=e.indexOf("..")||"."==e.charAt(0)||"."==e.charAt(e.length-1))&&_badParm()},_valSub=function(e){for(var t=e.split("."),r=t.length,n=0;r>n;n++)(""==t[n]||-1!=t[n].indexOf("*")&&"*"!=t[n]&&"**"!=t[n])&&_badParm(),"**"==t[n]&&r-1>n&&_badParm();return t},_cacheIt=function(e){return e&&"object"==typeof e&&e.PageBus&&e.PageBus.cache},_TopicMatcher=function(){this._items={}},_TopicMatcher.prototype.store=function(e,t){var r=e.split("."),n=r.length;_recurse=function(i,s){if(s==n)i["."]={topic:e,value:t};else{var a=r[s];i[a]||(i[a]={}),_recurse(i[a],s+1)}},_recurse(this._items,0)},_TopicMatcher.prototype.match=function(e,t){var r=e.split("."),n=r.length,i=[];return _recurse=function(e,s){if(e){var a;if(s==n)a=e;else{if(_recurse(e[r[s]],s+1),t)return;"**"!=r[s]&&_recurse(e["*"],s+1),a=e["**"]}a&&a["."]&&i.push(a["."])}},_recurse(this._items,0),i},_TopicMatcher.prototype.exists=function(e,t){var r=e.split("."),n=r.length,i=!1;return _recurse=function(e,s){if(e){var a;if(s==n)a=e;else{if(_recurse(e[r[s]],s+1),i||t)return;if("**"!=r[s]&&(_recurse(e["*"],s+1),i))return;a=e["**"]}a&&a["."]&&(i=!0)}},_recurse(this._items,0),i},_TopicMatcher.prototype.clear=function(e){var t=e.split("."),r=t.length;_recurse=function(e,n){if(e)if(n==r)e["."]&&delete e["."];else{_recurse(e[t[n]],n+1);for(var i in e[t[n]])return;delete e[t[n]]}},_recurse(this._items,0)},_TopicMatcher.prototype.wildcardMatch=function(e){var t=e.split("."),r=t.length,n=[];return _recurse=function(e,i){var s,a=t[i];if(e&&i!=r)if("**"==a)for(var o in e)"."!=o&&(s=e[o],s["."]&&n.push(s["."]),_recurse(s,i));else if("*"==a)for(var o in e)"."!=o&&"**"!=o&&(s=e[o],i==r-1?s["."]&&n.push(s["."]):_recurse(s,i+1));else{if(s=e[a],!s)return;i==r-1?s["."]&&n.push(s["."]):_recurse(s,i+1)}},_recurse(this._items,0),n},this._refs={},this._doCache=new _TopicMatcher,this._caches=new _TopicMatcher,_isCaching=function(e){return r._doCache.exists(e,!1)},_copy=function(e){var t;if("object"==typeof e){if(null==e)return null;if(e.constructor==Array){t=[];for(var r=0;e.length>r;r++)t[r]=_copy(e[r]);return t}if(e.constructor==Date)return t=new Date,t.setDate(e.getDate()),t;t={};for(var n in e)t[n]=_copy(e[n]);return t}return e},this._add=function(e,t){var r,n=this._doCache.match(e,!0);n.length>0?r=n[0].value:(r={rc:0},this._doCache.store(e,r)),r.rc++,this._refs[t]=e},this._remove=function(e){var t=this._refs[e];if(t){delete this._refs[e];var r=this._doCache.match(t,!0);if(0!=r.length&&(r[0].value.rc--,0==r[0].value.rc)){this._doCache.clear(t);for(var n=this._caches.wildcardMatch(t),i=0;n.length>i;i++)this._doCache.exists(n[i].topic,!1)||this._caches.clear(n[i].topic)}}},this.subscribe=function(e,t,r,n){n||(n=null);var i=OpenAjax.hub.subscribe(e,r,t,n);if(_cacheIt(n)){this._add(e,i);for(var s=this.query(e),a=0;s.length>a;a++)try{r.call(t?t:window,s[a].topic,s[a].value,n)}catch(o){PageBus._debug()}}return i},this.publish=function(r,n){if(_valPub(r),t.push({n:r,m:n,d:e+1}),_isCaching(r))try{this._caches.store(r,n)}catch(i){_badParm()}if(0==e)for(;t.length>0;){var s=t.shift();s.n.split(".");try{e=s.d,OpenAjax.hub.publish(s.n,s.m),e=0}catch(a){throw e=0,a}}},this.unsubscribe=function(e){try{this._remove(e),OpenAjax.hub.unsubscribe(e)}catch(t){_badParm()}},this.store=function(e,t){if(!_isCaching(e))throw Error("PageBus.cache.NoCache");this.publish(e,t)},this.query=function(e){try{return _valSub(e),this._caches.wildcardMatch(e)}catch(t){_badParm()}}},OpenAjax.hub.registerLibrary("PageBus","http://tibco.com/PageBus","1.2.0",{}));var e=PageBus.publish;PageBus.publish=function(){var t=arguments;setTimeout(function(){e.apply(PageBus,t)},1)};var t=function(e){return function(t){PageBus.publish("logger."+e,{body:t})}};return window.Logger={trace:t("trace"),debug:t("debug"),info:t("info"),warn:t("warn"),error:t("error"),fatal:t("fatal")},PageBus}),function(e,t){"object"==typeof exports&&exports?module.exports=t:"function"==typeof define&&define.amd?define("lib/mustache",t):e.Mustache=t}(this,function(){function e(e,t){return RegExp.prototype.test.call(e,t)}function t(t){return!e(d,t)}function r(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function n(e){return(e+"").replace(/[&<>"'\/]/g,function(e){return y[e]})}function i(e){this.string=e,this.tail=e,this.pos=0}function s(e,t){this.view=e,this.parent=t,this._cache={}}function a(){this.clearCache()}function o(e,t,r,n){for(var i,s,a,c="",u=0,l=e.length;l>u;++u)switch(i=e[u],s=i[1],i[0]){case"#":if(a=r.lookup(s),"object"==typeof a)if(m(a))for(var p=0,h=a.length;h>p;++p)c+=o(i[4],t,r.push(a[p]),n);else a&&(c+=o(i[4],t,r.push(a),n));else if("function"==typeof a){var d=null==n?null:n.slice(i[3],i[5]);a=a.call(r.view,d,function(e){return t.render(e,r)}),null!=a&&(c+=a)}else a&&(c+=o(i[4],t,r,n));break;case"^":a=r.lookup(s),(!a||m(a)&&0===a.length)&&(c+=o(i[4],t,r,n));break;case">":a=t.getPartial(s),"function"==typeof a&&(c+=a(r));break;case"&":a=r.lookup(s),null!=a&&(c+=a);break;case"name":a=r.lookup(s),null!=a&&(c+=f.escape(a));break;case"text":c+=s}return c}function c(e){for(var t,r=[],n=r,i=[],s=0,a=e.length;a>s;++s)switch(t=e[s],t[0]){case"#":case"^":i.push(t),n.push(t),n=t[4]=[];break;case"/":var o=i.pop();o[5]=t[2],n=i.length>0?i[i.length-1][4]:r;break;default:n.push(t)}return r}function u(e){for(var t,r,n=[],i=0,s=e.length;s>i;++i)t=e[i],t&&("text"===t[0]&&r&&"text"===r[0]?(r[1]+=t[1],r[3]=t[3]):(r=t,n.push(t)));return n}function l(e){return[RegExp(r(e[0])+"\\s*"),RegExp("\\s*"+r(e[1]))]}var f={};f.name="mustache.js",f.version="0.7.2",f.tags=["{{","}}"],f.Scanner=i,f.Context=s,f.Writer=a;var p=/\s*/,h=/\s+/,d=/\S/,g=/\s*=/,v=/\s*\}/,b=/#|\^|\/|>|\{|&|=|!/,m=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},y={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};f.escape=n,i.prototype.eos=function(){return""===this.tail},i.prototype.scan=function(e){var t=this.tail.match(e);return t&&0===t.index?(this.tail=this.tail.substring(t[0].length),this.pos+=t[0].length,t[0]):""},i.prototype.scanUntil=function(e){var t,r=this.tail.search(e);switch(r){case-1:t=this.tail,this.pos+=this.tail.length,this.tail="";break;case 0:t="";break;default:t=this.tail.substring(0,r),this.tail=this.tail.substring(r),this.pos+=r}return t},s.make=function(e){return e instanceof s?e:new s(e)},s.prototype.push=function(e){return new s(e,this)},s.prototype.lookup=function(e){var t=this._cache[e];if(!t){if("."==e)t=this.view;else for(var r=this;r;){if(e.indexOf(".")>0){t=r.view;for(var n=e.split("."),i=0;t&&n.length>i;)t=t[n[i++]]}else t=r.view[e];if(null!=t)break;r=r.parent}this._cache[e]=t}return"function"==typeof t&&(t=t.call(this.view)),t},a.prototype.clearCache=function(){this._cache={},this._partialCache={}},a.prototype.compile=function(e,t){var r=this._cache[e];if(!r){var n=f.parse(e,t);r=this._cache[e]=this.compileTokens(n,e)}return r},a.prototype.compilePartial=function(e,t,r){var n=this.compile(t,r);return this._partialCache[e]=n,n},a.prototype.getPartial=function(e){return e in this._partialCache||!this._loadPartial||this.compilePartial(e,this._loadPartial(e)),this._partialCache[e]},a.prototype.compileTokens=function(e,t){var r=this;return function(n,i){if(i)if("function"==typeof i)r._loadPartial=i;else for(var a in i)r.compilePartial(a,i[a]);return o(e,r,s.make(n),t)}},a.prototype.render=function(e,t,r){return this.compile(e)(t,r)},f.parse=function(e,n){function s(){if(j&&!E)for(;k.length;)delete A[k.pop()];else k=[];j=!1,E=!1}if(e=e||"",n=n||f.tags,"string"==typeof n&&(n=n.split(h)),2!==n.length)throw Error("Invalid tags: "+n.join(", "));for(var a,o,d,m,y,_=l(n),x=new i(e),w=[],A=[],k=[],j=!1,E=!1;!x.eos();){if(a=x.pos,d=x.scanUntil(_[0]))for(var P=0,S=d.length;S>P;++P)m=d.charAt(P),t(m)?k.push(A.length):E=!0,A.push(["text",m,a,a+1]),a+=1,"\n"==m&&s();if(!x.scan(_[0]))break;if(j=!0,o=x.scan(b)||"name",x.scan(p),"="===o?(d=x.scanUntil(g),x.scan(g),x.scanUntil(_[1])):"{"===o?(d=x.scanUntil(RegExp("\\s*"+r("}"+n[1]))),x.scan(v),x.scanUntil(_[1]),o="&"):d=x.scanUntil(_[1]),!x.scan(_[1]))throw Error("Unclosed tag at "+x.pos);if(y=[o,d,a,x.pos],A.push(y),"#"===o||"^"===o)w.push(y);else if("/"===o){if(0===w.length)throw Error('Unopened section "'+d+'" at '+a);var T=w.pop();if(T[1]!==d)throw Error('Unclosed section "'+T[1]+'" at '+a)}else if("name"===o||"{"===o||"&"===o)E=!0;else if("="===o){if(n=d.split(h),2!==n.length)throw Error("Invalid tags at "+a+": "+n.join(", "));_=l(n)}}var T=w.pop();if(T)throw Error('Unclosed section "'+T[1]+'" at '+x.pos);return A=u(A),c(A)};var _=new a;return f.clearCache=function(){return _.clearCache()},f.compile=function(e,t){return _.compile(e,t)},f.compilePartial=function(e,t,r){return _.compilePartial(e,t,r)},f.compileTokens=function(e,t){return _.compileTokens(e,t)},f.render=function(e,t,r){return _.render(e,t,r)},f.to_html=function(e,t,r,n){var i=f.render(e,t,r);return"function"!=typeof n?i:(n(i),void 0)},f}()),define("src/logging",[],function(){var e=window.console,t=function(){};return e||(e={trace:t,debug:t,info:t,warn:t,error:t,fatal:t}),e.debug||(e.debug=e.log),e}),define("src/modules",["src/extendedjquery","lib/pagebus","lib/mustache","src/logging"],function(e,t,r,n){var i=function(e){return{resolver:"string",arg:e||""}},s=function(e){return{resolver:"find",arg:[i(e||":self")]}},a=function(e){return{resolver:"obj",arg:e||"{}"}},o={effect:{properties:["name","target","duration","easing","relative"],defaults:{target:s(),duration:i("slow"),easing:i("swing"),relative:s()},apply:function(t,r){var n,i=t.target.length,s=t.name.split(","),a=function(){return function(e,t,r,n){0===--e&&(t.dequeue("pseudo"),r.target.trigger("post-"+n))}};0===i&&r.dequeue("pseudo"),r.queue("pseudo").unshift(e.noop);for(var o=0;s.length>o;o++)n=e.trim(s[o]),t.target[n](t.duration,t.easing,a(i,r,t,n),t.relative)}},publish:{properties:["topic","data","timer","repeat"],defaults:{data:a(),timer:i(0),repeat:i(1)},apply:function(r){var n,i,s,a;n=r.repeat||1,i="infinity"==r.repeat,s=setInterval(function(){!i&&0>=n?a():(n--,t.publish(e.isArray(r.topic)?r.topic[0]:r.topic,r.data||{}))},r.timer),a=function(){clearInterval(s)}}},"class":{properties:["op","name","target"],defaults:{op:"toggle",target:s()},apply:function(t){t.name=e.isArray(t.name)?t.name.join(" "):t.name,t.name&&t.target[t.op+"Class"](t.name)}},redirect:{properties:["uri"],defaults:{},apply:function(e){window.location.href=e.uri}},form:{properties:["target","data"],defaults:{},apply:function(t){var r,n,i,s=t.target[0];if(t.data=t.data||"",t.target)for(t.target="form"===s.tagName.toLowerCase()?t.target.find(":file,:hidden,:input,:radio,:checkbox"):t.target,n="string"==typeof t.data||e.isArray(t.data),r=0;t.target.length>r;r++)i=n?t.data:t.data[t.target[r].name],e(t.target[r]).val(i)}},html:{properties:["op","source","target"],defaults:{target:s(),source:{resolver:"html",arg:s()},op:{resolver:"string",arg:"replaceContent"}},apply:function(t,n){var i,s,a;i=["append","replaceContent","prepend","replaceWith","wrapInner","wrap"],s=t.id||t.source,a=e.inArray(t.op,i)>-1?s:null,s?(n.queue("pseudo").unshift(e.noop),str=r.to_html(a,t.data,{}),c(t.op,str,t.target),n.dequeue("pseudo")):c(t.op,a,t.target)}}},c=function(e,t,r,i){n.debug("Default Modifier called within Modules."),i&&i()},u=function(e){return o[e]};return u.resolvers={str:i,find:s,obj:a},u.setModifier=function(e){c=e},u.cache=o,u}),define("src/dommod",["src/extendedjquery","lib/pagebus","src/logging"],function(e,t,r){return mod=function(n,s,a){var o,c,u,l;if("replaceContent"==n||"remove"===n||"empty"===n){for(o=e("*",a),u=o.filter('[bess_parsed="true"]'),i=0;u.length>i;i++)for(c=u[i],l=bessRules.length-1;l>=0;l--)bessRules[l].selector.boundFrom===c&&bessRules.splice(l,1);if("replaceContent"===n)a.empty(),n="append";else if("remove"===n||"empty"===n)return a[n](),r.debug("Triggering html-modified..."),a.trigger("html-modified"),void 0}e.browser.msie?(id=e.now(),d=document.createElement("div"),d.id="temp"+id,d.style.display="none",document.body.appendChild(d),d=document.getElementById("temp"+id),d.innerHTML=s,a[n](e(d.childNodes)),document.body.removeChild(d)):a[n](s),t.publish("document.scan",{context:a,isLocal:!0}),t.publish("document.inserted.children",{context:a})}}),define("src/jpath",["src/extendedjquery"],function(e){var t=function(r,n,i,s){var a,o,c=0,u=!0;if(r&&s>i.length)if(e.isArray(r))for(;r.length>c;c++)t(r[c],n,i,s);else{for(c=0;u&&n.length>c;c++)o=r[n[c].prop],o!==void 0?n[c].re&&(u=n[c].re.test(o)):u=!1;u&&i.push(r);for(a in r)"object"==typeof r[a]&&t(r[a],n,i,s)}},r=function(r,n,i){for(var s,a,o,c=0,u=n.split(/(\[|\])/),l=[],f=[];u.length>c;c++)a=e.trim(u[c]),/\[|\]/.test(a)||""===a||(a=u[c].split(/\W?=/),s=n.match(/(\W?=)/),o={prop:e.trim(a[0])},a.length>1&&s&&s.length>0&&(s=s[0].charAt(0),a[1]=a[1].replace(/\'/g,""),"^"===s?a[1]="^"+a[1]:"$"===s?a[1]=a[1]+"$":"*"!==s&&(a[1]="^"+a[1]+"$"),o.re=RegExp(a[1])),l.push(o));return t(r,l,f,i||Number.MAX_VALUE),f};return r}),define("src/typeresolvers",["src/extendedjquery","lib/mustache","src/jpath"],function(e,t,r){var n=function(t,r){var n,i,s,a,o,c;return n=(r[0]+" ").split("<"),s=""===n[0],i=s?"#"+t.attr("id")+n[1]:n[0],n.length>1&&!s?(a="*"==n[0],o=a?"*:not(#"+t.attr("id")+")":n[0],t=t.closest(o)," "!=n[1]&&(t=t.find(n[1])),c=t):c=e(i),c},i=function(e,t){var r,n,i,s,a=0,o=[],c=e.length%t;for(s=Math.floor(e.length/t),n=0;t>n;n++){for(i=[],s=0===o.length?s+c:Math.round(e.length/t),r=0;s>r;r++)e[a]&&(i.push(e[a]),a++);o.push(i)}return o},s={message:function(t,r,n,i,s){var a=s||{};r=e.isArray(r)?r[0]:r,n.setVal(i,r&&""!==r?a[r]:a)},capture:function(t,r,i,s){var a,o=[];for(t=n(t,r),a=0;t.length>a;a++)o.push(e(t[a]).val());i.setVal(s,o)},collect:function(t,r,n,i){var s,a=r[0],o=t,c=[],u="";2===r.length?"string"==typeof r[1]?u=r[1]:o=r[1]:3===r.length&&"string"==typeof r[2]&&(o=r[1],u=r[2]),o.jquery&&(o=e.makeArray(o)),o=e.isArray(o)?o:[o];for(var l=0;o.length>l;l++)s=e(o[l]),s.attr(a)?c.push(s.attr(a)):u&&c.push(u);n.setVal(i,c)},cut:function(t,r,n,i){var s=e("<div></div>");s.append(r[0][0]),n.setVal(i,s.html())},markup:function(t,r,n,i){n.setVal(i,e(r[0][0]).html())},number:function(e,t,r,n){r.setVal(n,parseInt(t[0],10))},string:function(e,t,r,n){r.setVal(n,""+t[0])},find:function(e,t,r,i){r.setVal(i,n(e,t))},request:function(t,r,n,i){var s=r[0],a={success:function(e){n.setVal(i,e)},error:function(){var e=i+" ("+this.url+"):"+arguments[2];n.setError(e,arguments[0])},type:"GET",dataType:"text"};"string"==typeof s?a.url=s:"string"==typeof s[0]?a.url=s[0]:s[0].tagName&&"form"===s[0].tagName.toLowerCase()?(a.url=s[0].getAttribute("action"),a.data=s.serialize(),a.type=s[0].getAttribute("method")||"GET",a.contentType=s[0].getAttribute("enctype")||"application/x-www-form-urlencoded",s[0].getAttribute("accept")&&(a.accepts=s[0].getAttribute("accept"))):a.data=e.param(s),r.length>=2&&(a.type=r[1]),3===r.length&&(a.url=r[2]),0===a.url.indexOf("#")?n.setVal(i,t):""===a.url?n.setVal(i,""):e.ajax(a)},obj:function(t,r,n,i){var s,a={};"{"===r[0].match(/\S/)[0]?n.setVal(i,JSON.parse(r[0])):(s=r[0].split("&"),e.each(s,function(t,r){var n,i=r.split("=");a[i[0]]?(n=a[i[0]],e.isArray(a[i[0]])||(a[i[0]]=[a[i[0]]]),a[i[0]].push(i[1])):a[i[0]]=i[1]}),n.setVal(i,a))},cookie:function(e,t,r,n){s.obj(e,document.cookie,r,n,",")},combine:function(t,r,n,i){for(var s={},a=0,o=r.length;o>a;a++)e.extend(s,r[a]);n.setVal(i,s)},mash:function(t,r,n,s){var a,o,c,u,l,f=r[1],p=0;if(a=e.isArray(r[0])?r[0][0]:r[0],"string"==typeof r[1])try{f=JSON.parse(f)}catch(h){f=[f]}if(l=function(e,t,r,i){e.apply(t,function(a,o){p++,a?(u=!0,n.setError(e,a)):(i[r]=o,p>=t.length&&n.setVal(s,i.join("")))})},e.isArray(f)&&r.length>2)for(f=i(f,r[2]),o=Array(f.length),c=0;f.length>c&&!u;c++)l(a,f[c],c,o);else a.apply(f,function(e,t){e?n.setError(a,e):n.setVal(s,t)})},template:function(t,r,n,i){var s=n,a=window.bess_templates?window.bess_templates:{},o=a[r[0]];o?s.setVal(i,o):e.get(r[0],function(e){s.setVal(i,e)},"html").error(function(){s.setError(i,"unable to load "+r[0])})},subset:function(t,n,i,s){var a="string"==typeof n[1]?JSON.parse(n[1]):n[1];path=e.isArray(n[0])?n[0][0]:n[0],a=r(a,path,n[2]),i.setVal(s,a)},fromQuery:function(e,t,r,n){var i="",s=0,a=window.location.search.substring(1).split("&");for(s=0;a.length>s;s++)0===a[s].indexOf(t[0])&&(i=a[s].split("=")[1]);r.setVal(n,i)},range:function(e,t,r,n){var i=0,s=t[0]||"0",a=t[1]||"0",o=t[2]||"1",c=[];for(i=parseInt(s,10);parseInt(a,10)>i;i+=parseInt(o,10))c.push(i);r.setVal(n,c)}};return s.to=s.find,s.from=s.find,s.where=s.find,s}),define("src/typeresolverengine",["src/extendedjquery","src/typeresolvers","src/logging"],function(e,t,r){var n=t,i=function(e,t,r,n,i){setTimeout(function(){s.property(e,t,r,n,i)},1)},s={properties:function(e,t,n,s,a){var o,c={},u={ct:0,setVal:function(e,i){c[e]=i,this.ct--,r.debug("resolved "+e+"..."+this.ct+" remaining"),0===this.ct&&n(c,t)},setError:function(){a(c,arguments)}};for(o in e)e[o].resolver&&("none"===e[o].arg?delete e[o]:u.ct++);try{for(o in e)e[o].resolver&&i(e[o],t,u,o,s)}catch(l){u.setError(c,l)}},property:function(t,i,a,c,u){var l=a,f=[t],p=t.arg;e.isArray(p)||s.buildStack(t,f);var h=function(e,t){return"string"==typeof e&&o(i,e.replace(/th\(index\)/g,"th("+i.index()+")"))||t},d=function(e,t,r){return function(n,i){e--,t[this.i]=h(i,i),0===e&&r(t)}},g=function(e,t){for(var r,n=e.length,a=[],o=0;e.length>0;)r=e.shift(),s.property(r,i,{i:o++,setVal:d(n,a,t),setError:l.setError},c,u)},v=function(t){if(t&&t.pop){var s=t.pop();if(e.isArray(s.arg))g(s.arg.slice(0),function(e){if(n[s.resolver])try{n[s.resolver](i,e,l,c,u)}catch(t){l.setError(s.resolver,t)}else r.error("unknown type resolver: '"+s.resolver+"'")});else if(p=h(s.arg,p),l=0===t.length?a:{setVal:function(e,t){p=h(t,t),v()},setError:l.setError},n[s.resolver])try{n[s.resolver](i,[p],l,c,u)}catch(o){l.setError(s.resolver,o)}else r.error("unknown type resolver: '"+s.resolver+"' should it be in an array?")}};v(f)},buildStack:function(e,t){e.arg.resolver&&(t.push(e.arg),s.buildStack(e.arg,t))}},a=e.now(),o=function(e,t){return e.attr("id")||e.attr("id","bess_"+a++),t.replace(":self","#"+e.attr("id"))};return s}),define("src/stringscanner",[],function(){var e={create:function(e){var t=e;return{toString:function(){return t},current:"BEGIN",test:null,index:0,tailIndex:t.length-1,setIndex:function(e){return this.current=t[e],this.index=e,this},readUntil:function(e){var r,n=0,i=e.length?e:[e];for(this.index;this.tailIndex>=this.index;this.index++)for(r=t.charAt(this.index),n=0;i.length>n;n++)if(i[n]&&i[n].test(r))return this.current=r,this.test=i[n],this;return this},sniff:function(e){var r=t.substr(this.index,e.length);return r===e?(this.index+=e.length,this.current=t.charAt(this.index),!0):!1},capture:function(e,r){return t.substring(e,r)},nextIndexOf:function(e){return t.indexOf(e,this.index)},tailIndexOf:function(e){return t.lastIndexOf(e,this.tailIndex)},peek:function(e){return t.charAt(this.index+(e||1))},isDone:function(e){return this.index>=(e||this.tailIndex)},advance:function(e){return this.index=this.index+(e||1),this.current=t.charAt(this.index),this},skipWhitespace:function(){return this.readUntil([/\S/]),this}}}};return e}()),define("src/bessvalueparser",["src/extendedjquery","src/stringscanner","src/modules","src/typeresolvers","src/logging"],function(e,t,r,n,i){return function(e){var s={isQuote:/\'/,isNumeric:/\d/,isSemi:/\;/,isOpenParen:/\(/,isCloseParen:/\)/,isOpenBrace:/\{/,isComma:/\,/,isColon:/\:/,isAtSymbol:/\@/,whiteSpace:/\s/,behavior:/^\-be\-([^\-]*)|^([a-z]*[A-z]*)/,pseudo:/\:/,pre:/\([^\)]+\)/,ids:/#[\d\w\-_]+/g,cls:/[\.:\[][^\.:\[+>]+/g,tag:/(^|[\s\+>])\w+/g};s.chop=[s.ids,s.cls,s.tag],"map"in Array.prototype||(Array.prototype.map=function(e,t){for(var r=Array(this.length),n=0,i=this.length;i>n;n++)n in this&&(r[n]=e.call(t,this[n],n,this));return r});var a={calc:function(e){return e=e.replace(s.pre,""),parseInt(s.chop.map(function(t){var r=e.match(t);return r?r.length.toString(16):0}).join(""),16)}},o=function(r,n){var i=[],s=e.Deferred();return e.when(u(t.create(r),n)).then(function(){i=f(t.create(r),n),n&&n.attr("bess_parsed","true"),s.resolve(i)}),s.promise()},c=function(t,s){var a=e.Deferred();return require([s],function(e){e?"module"===t?(i.debug("resolved module "+e.name+" at "+(new Date).getTime()),r.cache[e.name]=e):"type"===t&&(n[e.typeName]=e):i.error("Unable to find "+t+" at "+s),a.resolve()}),a.promise()},u=function(t){var r,n=e.Deferred(),i=[];if(t.skipWhitespace(),t.isDone()&&n.resolve(),l(t),"@"!==t.current)n.resolve();else{for(;"@"===t.current;)t.advance(),t.sniff("import")&&(t.skipWhitespace(),r=A(t),i.push(c(r,x(t))),t.advance().readUntil(s.isAtSymbol));e.when.apply(e,i).then(function(){n.resolve()})}return n.promise()},l=function(e){return"/"===e.current&&"*"===e.peek()?(e.setIndex(e.nextIndexOf("*/")).advance(2),e.skipWhitespace(),!0):void 0},f=function(e,t){var r,n=[];if(e=p(e),e.skipWhitespace(),e.isDone())return n;for(l(e),r=h(d(e),t);r;)r?n=n.concat(r):i.debug("No rule returned during parseRules loop."),r=h(d(e),t);return n},p=function(e){return e.skipWhitespace(),e.sniff("@")?(e.readUntil(s.isSemi).advance(),p(e)):e},h=function(t,n){if(t){var i,o,c={},u=[];return e.each(t.declarations,function(e){var t=e.match(s.behavior);if(t){var r=t[2]?t[2]:t[1];r&&(c[r]=!0)}}),e.each(t.selectors,function(l){var f=t.selectors[l];e.isEmptyObject(c)||(i=f.split(s.pseudo),o={pseudo:i.pop(),select:i.join(":"),boundFrom:n,ruleId:t.pid},o.score=a.calc(o.select),e.each(c,function(e){var n=r(e);parsedRule=b(t.declarations,e,n.properties),u.push({selector:o,declaration:parsedRule,module:e})}))}),u}},d=function(e,t){var r,n=t||{selectors:[],pid:e.index};return e.skipWhitespace(),l(e),r=e.skipWhitespace().index,e.readUntil([s.isComma,s.isOpenBrace]),","===e.current?(g(n,e.capture(r,e.index)),e.advance(),d(e,n)):"{"===e.current?(g(n,e.capture(r,e.index)),e.advance(),n.declarations=v(e,{}),n):void 0},g=function(t,r){r.match(/\)/g)&&!r.match(/\(/g)?t.selectors[t.selectors.length-1]+=", "+r:t.selectors.push(e.trim(r))},v=function(e,t){var r,n=e.skipWhitespace().index;return l(e)?v(e,t):("}"!==e.current?(e.readUntil(s.isColon),r=e.capture(n,e.index),n=e.advance().skipWhitespace().index,e.readUntil(s.isSemi),t[r]=e.capture(n,e.index),e.advance(),v(e,t)):e.advance(),t)},b=function(r,n,i){var s={},a=r,o=r[n];o&&(a=e.extend({},m(o,n,i),r));var c=function(r){var i=n+"-"+r,o=a[i];o&&(s[r]=e.isPlainObject(o)?o:y(t.create(o))[0])};return e.each(i,function(e,t){c(t)}),s},m=function(e,r,n){for(var i=y(t.create(e),!0),s=0,a=0,o={},c=0;i.length>c;c++)n.length>c&&(o[r+"-"+n[a]]={}),i[c].x&&(a=0,s++),o[r+"-"+n[a]][s+""]=i[c],a++;return o},y=function(e,t){var r,n=[],i=0,s={};for(i;;i++){if(r=_(e),!r)return n;s[i]=r,n.push(t?r:s)}},_=function(e){var t;if(!e.skipWhitespace().isDone()){if("'"===e.current)return{resolver:"string",arg:x(e)};if(s.isNumeric.test(e.current))return{resolver:"number",arg:w(e)};if(s.isComma.test(e.current))return t=_(e.advance()),t.x=!0,t;var r={resolver:A(e),arg:[]};if(s.isCloseParen.test(e.current))return e.advance(),r;for(t=_(e,!0);t&&(r.arg.push(t),e.skipWhitespace().advance(),s.isComma.test(e.peek(-1)));)t=_(e,!0);return r}},x=function(e){var t=e.capture(e.advance().index,e.readUntil(s.isQuote).index);return e.advance(),t},w=function(e){var t=e.capture(e.index,e.readUntil([s.whiteSpace,s.isSemi]).index);return e.advance(),t},A=function(e){var t=e.capture(e.index,e.readUntil([s.isOpenParen]).index);return e.advance(),t},k={},j=function(t,r,n){var s,a,c=[],u=0;window.localStorage||(window.localStorage={});var l=function(t,r){var n=e.Deferred();return u--,r&&e(r).attr("bess_parsed")?n.resolve():o(t,r).done(function(e){c=c.concat(e),n.resolve()}),n.promise()},f=function(e,t){l(e,t).done(p)},p=function(){0===u&&t&&t(c)};return k=n||{},r?(u+=r.length,e.each(r,function(t,r){e.get(r,f,"text")})):(s=e('link[type="text/bess"]'),u+=s.length,a=e('style[type="text/bess"]'),u+=a.length,i.debug("BESS found "+u+" sheets to parse."),s.each(function(){var t=this;i.debug("BESS parsing link tag."),this.disabled||/^\w+:/.test(e(this).attr("href"))||!mediumApplies(this.media)||e(this).attr("bess_loaded")?e(this).attr("bess_loaded")&&(i.debug("Link tag found bess_loaded already."),f("",t)):(e(this).attr("bess_loaded","true"),e.get(this.href,function(e){f(e,t)},"text"))}),a.each(function(){i.debug("BESS parsing style tag."),f(this.innerHTML,this)})),this};mediumApplies=window.media&&window.media.query||function(t){if(!t)return!0;if(t in k)return k[t];var r=e('<style media="'+t+'">body {position: relative; z-index: 1;}</style>').appendTo("head");return k[t]=[1==e("body").css("z-index"),r.remove()][0]};var E=function(e,t){var r=[];return o(e,t).done(function(e){r=e}),r};return{parse:E,loadAndParse:j}}(e)}),define("src/behavior",["src/extendedjquery","lib/pagebus","src/modules","src/dommod","src/typeresolvers","src/typeresolverengine","src/bessvalueparser","src/logging"],function(e,t,r,n,i,s,a,o){r.setModifier(n);var c=[],u=function(t,r){a.loadAndParse(function(n){e.each(n,function(e){c.push(e.selector.select)}),window.bessRules=window.bessRules.concat(n),x(t,window.bessRules,!r)})},l=i,f=function(e){return e.sort(function(e,t){return e.selector.score>t.selector.score?1:t.selector.score>e.selector.score?-1:0})},p=function(e,t,r){r.queue("pseudo",[function(){r.trigger("pre-"+e).dequeue("pseudo")},function(){t(),r.dequeue("pseudo")},function(){r.trigger("post-"+e).dequeue("pseudo")}]),r.dequeue("pseudo")};window.localStorage||(window.localStorage={}),t.subscribe("document.scan",null,function(e,t){u(t.context,t.isLocal)}),t.subscribe("document.inserted.children",null,function(t,r){var n,i,s,a=r.context;for(s=a.find("*").filter(c.join(",")),n=0;s.length>n;n++)i=new e.Event("html-inserted"),i.preventDefault(),o.debug("Triggering html-inserted."),e(s[n]).trigger(i);o.debug("Triggering html-modified."),a.trigger("html-modified")});var h={clicked:"click",changed:"change",blurred:"focusout",validated:"submit"},d=function(t){var r=h[t]?h[t]:t;return"transitioned"==t&&(r=e.browser.webkit?"webkitTransitionEnd":e.browser.opera?"oTransitionEnd":e.browser.mozilla?"transitionend":"transitionend"),r},g=function(t,r){t.preventDefault(),t.actionable||(t.actionable=[],t.actionableIds=[],t.target=t.currentTarget||t.target),-1===e.inArray(t.data.module+":"+t.data.selector.ruleId,t.actionableIds)&&(t.message=r,t.actionable.push(t.data),t.actionableIds.push(t.data.module+":"+t.data.selector.ruleId))},v={},b={},m=function(e){var t={},r=null,n=null;for(r in e){var i=e[r];for(n in i)t[n]=!0}return t},y=function(e){var t,r=[],n=m(e),i=null;for(i in n){t={};for(var s in e){if(!e[s][i])return r;t[s]=e[s][i]}r.push(t)}return r},_=function(n){var i=n.selector.pseudo,a=n.selector;i.split(/\./).length>1&&(b[i]?b[i][a.select]||b[i].push(a.select):(b[i]=[a.select],t.subscribe(i,null,function(t,r){var n=e(b[i].join(",")).toArray(),s=[],a=0;for(o.debug("triggering "+i+" from subscription...");n.length>a;a++)0===e(n[a]).has(n.slice(a+1)).length&&s.push(n[a]);e(s).trigger(i,r)})));var c=d(i);e(n.selector.select).live(c,n,g),v[c]||(e(document).bind(c,function(t){var n,c={},u={};if(t.actionable){if("html-inserted"===t.type){if(t.target.bess_dom_inserted)return!1;t.target.bess_dom_inserted=!0}if("html-modified"===t.type&&t.currentTarget!==t.target)return o.debug("bailing... html-modified current target:"+t.currentTarget.tagName+" - target:"+t.target.tagName),void 0;"html-inserted"===t.type&&t.currentTarget!==t.target?(o.debug("switching... html-inserted current target:"+t.currentTarget+" - target:"+t.target),t.currentTarget=t.target):"submit"===t.type&&t.target.tagName&&"BUTTON"===t.target.tagName&&(t.target=t.currentTarget);
for(var l=0;t.actionable.length>l;l++)n=t.actionable[l],o.debug("handling "+n.selector.select+" "+a.pseudo),c[n.module]=c[n.module]||{},n.selector.pseudo==i&&(e(t.target).is(n.selector.select)||e(t.currentTarget).is(n.selector.select))&&e.extend(c[n.module],n.declaration),u[n.selector.select]=!0;o.debug("merged:"+JSON.stringify(c,null,4));var f=e(t.currentTarget);p(i,function(){for(var n in c){var i=new r(n);if(i){o.debug("resolving module..."+n);var u=y(c[n]);for(l=0;u.length>l;l++){var p=e.extend({},i.defaults,u[l]);s.properties(p,f,i.apply,t.message,function(e,t){o.error("Problem resolving: "+t[0]+"\n\n- "+t[1].message+"\n\n- in "+JSON.stringify(p)),e.topic?f.trigger("error"):e.target&&e.target.trigger("error")})}}else o.error('Ignoring unknown module "'+n+'" in "'+a.select+":"+a.pseudo+'"')}},f)}}),v[c]=!0)},x=function(t,r,n){if(t||(t=e(document)),f(r),e.each(r,function(e,r){_(r,t),n&&/html-inserted$/.test(r.selector.pseudo)&&c.push(r.selector.select)}),n){o.debug("triggering html-inserted globally...");var i=function(){setTimeout(function(){e(c.join(",")).trigger("html-inserted")},1)};e.isReady?i():e.ready(i)}};return{"::":l,":":r.cache,process:x,init:u}}),define("src/bess.js",["src/extendedjquery","src/behavior","src/bessvalueparser","src/modules","src/logging"],function(e,t,r,n,i){var s=function(){r.loadAndParse(function(e){i.debug("BESS go parse found "+e.length+" rules."),window.bessRules=bessRules.concat(e),t.init()})};return r.loadAndParse(function(t){i.debug("BESS early parse found "+t.length+" rules."),window.bessRules=t,e.isReady?s():e(document).ready(s)}),{parser:r,engine:t,resolvers:n.resolvers}});